
[TOC]

# 常用命令

## 1 用户相关

## 2 时间相关

- 将指定时间戳转为指定格式的日期时间，```date -d @unix_ts [format]```；
- 将指定格式的日期时间转为unix时间戳，```date -d "yyyy-MM-dd hh:mm:ss" +%s```，将当前时间转为unix时间戳```date +%s```；

## 3 文件相关

### 3.1 查看日志文件
- 查看日志文件中正持续写入的日志信息，```tail -f ${logfile}```或者```tailf ${logfile}```；
- 查看历史日志文件、日志刷新频率太快的日志信息，可以直接使用vim进行查看，指定```vim -u NONE```可以让vim忽略很多额外的配置项，加载日志文件更快；

查看日志时可能只希望显示遵循特定pattern的部分，这时可以结合 **grep** 来使用，例如：```tail -f ${logfile} | grep <keyword> --color -C 5```。

### 3.2 查看文件大小
- 查看当前目录下各个文件大小，```ls -l -h```或```ll -h```，如果希望排序可以使用```ll -hS```；
ls命令不会对文件夹占用的总的空间大小进行统计，如果要统计文件夹的空间大小需要使用```du```。
- 查看当前文件夹的大小，```du -hs .```；
- 查看当前目录下所有文件夹的大小并排序，```du -h --max-depth=1 . | sort -rh```；

### 3.3 搜索文件
- 按名字进行搜索，```find <dir> -iname <pattern>```，```-iname```表示文件名忽略大小写；
- 按尺寸进行搜索，```find <dir> -size +20M```，搜索目录dir下尺寸大于20M的所有文件；

对于搜索出的文件，find提供了几个选项可以执行删除或者自定义的操作：
- 执行搜索并删除，如```find -name "*.log" -delete```；
- 执行自定义操作，如搜索并查看，```find -name "*.log" -exec cat {} +```；

## 4 进程相关

- 查找打开文件的进程
fuser命令可以用于查找打开指定文件的进程，例如查看打开tcp端口8080的进程id，可以通过```fuser 8080/tcp```进行查询。如果想杀死该进程还可以指定参数```-k```，即```fuser -k 8080/tcp```。如果该文件不是当前用户的进程打开的，fuser命令则无法查询到对应的进程。
    
- 查看进程打开的文件
lsof命令

## 5 cpu相关

- top命令

## 6 内存相关

- 查看剩余内存容量（以MB为单位），```free -m```；
- 强制释放文件page cache占用的内存空间，```echo 3 > /proc/sys/vm/drop_caches```；

## 7 网络相关

### 7.1 netstat

netstat可以用于对系统网络状态进行统计，也是网络程序开发中的调试利器，例如借助它可以更有效地跟踪tcp连接状态的变化以发现代码中可能存在的bug等。
常用命令```netstat -nlp```，```-n```不转换端口数值为名称，```-l```只显示处于监听状态的端口，```-p```显示打开该socket的进程pid、进程名称。如果指定```-a```参数，则显示处于监听、非监听状态的socket。

### 7.2 telnet
网络程序开发中，访问对应服务前需要检测一下服务端是否可访问，假如服务端是以tcp方式工作的，可以通过```telnet server-ip server-port```来检测网络连通性。服务端一般是以tcp、udp两种形式同时监听同一个端口的。
但是也不排除这种情况，即一个后台服务值监听udp端口，而不监听tcp端口，udp端口的连通性测试可以借助```tcpdump```或者```iperf```、```nc```来测试。

- tcpdump观察客户端、服务端之间的udp报文可以辅助确定目的udp端口是否被监听；
- iperf、nc也可以借助数据发送来测试目的udp端口是否被监听，参考链接：https://support.asperasoft.com/hc/en-us/articles/216126068-UDP-connectivity-testing。

### 7.3 rz、sz、md5sum
文件上传、下载可以借助于rz、sz来实现，为了保证文件的完整性需要对文件进行md5校验。文件上传之前需要先借助md5sum对文件校验和进行计算，然后借助rz开始上传。上传完成之后需要通过md5sum重新计算校验和并与上传之前的校验和进行对比，二者一致表明文件数据一致。下载文件时也需要对校验和进行比较。

>备注：
>一些支持下载的站点除了提供要下载的软件包之外，往往都会这个软件包的md5值，以便于用户文件下载完成后对数据完整性进行校验。平时生活中自己可能不在乎这个，但是在工作中必须要重视这点，尤其是要在生产环境中发布软件包的时候。

### 7.4 tcpdump

在Linux后台开发过程中，某些场景下需要对网络流量进行    分析，tcpdump是一款抓包工具，某些情况下可以直接对其输出进行分析，更加复杂的场景下可以将tcpdump抓取的包存储到文件中以供其他更加复杂的流量分析工具进一步分析。掌握tcpdump的实用技巧是至关重要的。

本周末我对tcpdump进行了一定的学习，参考下面的帖子：https://danielmiessler.com/study/tcpdump/#gs.tCza_9c。

## 8 http相关

### 8.1 ab

使用ab（apache benchmark）进行压测的常用命令选项：

- -n 请求总数量
- -c 并发请求数量
- -r 收到socket错误时ab不退出
- -k keepAlive
- -T 内容类型
- -H 指定头部信息，例如cookie、referer字段等(例如需要qq登录态鉴权的话指定cookie就可以了)；
- -X 指定http代理ip:port

压测命令：```ab -n <总请求数> -r -k -c <并发请求数> -H <header> -T <content-type> -X <proxy> <url>```

命令示例：

```
ab -n 100 -r -k -c 100 \
-T "application/x-www-form-urlencoded" \
-H "Referer:http://now.qq.com" \
-H "Cookie:pac_uid=1_1194606858; _supWebp=1; RK=hmlLEzC2HK; pgv_pvi=456501248; pgv_si=s2696879104; ptui_loginuin=1194606858; pt2gguin=o1194606858; uin=o1194606858; skey=@ZbscQC5SL; ptisp=ctc; ptcz=8c2c8564667f2162e1f009ae31f05402574782766400ed09dee6b137ceabde42; pgv_info=ssid=s6830408540; pgv_pvid=4280629932; o_cookie=1194606858" 
-X localhost:80 \
http://now.qq.com/cgi-bin/now/web/discover/get_whitelist_subject_detail?topic=knknkn
```

### 8.2 curl

如果只需要简单测试一下cgi请求、响应数据是否正常而非性能测试的话，可以使用curl。

curl命令格式为：```curl -e <referer> -b <cookie> <url>```






